<!-- app/templates/complex.html -->
{% extends "base.html" %}

{% block title %}Complex analytics · arXiv Explorer{% endblock %}

{% block content %}
<section class="pane">
  <h1 class="pane-title">Complex analytics reports</h1>
  <p class="pane-subtitle">
    These CSV files are generated by the Spark SQL analytics pipeline
    (<code>engine/complex/complex_queries.py</code>).
  </p>

  <form method="get" action="{{ url_for('main.complex_reports') }}" class="form-grid">
    <div class="form-row">
      <label for="mode">Dataset</label>
      <select id="mode" name="mode" class="input" onchange="this.form.submit()">
        {% for key, label in dataset_choices.items() %}
        <option value="{{ key }}" {% if key == mode %}selected{% endif %}>
          {{ label }}
        </option>
        {% endfor %}
      </select>
    </div>

    {% if reports %}
    <div class="form-row">
      <label for="path">Report CSV</label>
      <select id="path" name="path" class="input" onchange="this.form.submit()">
        <option value="">— choose a report —</option>
        {% for r in reports %}
        <option value="{{ r.path }}" {% if r.path == selected_path %}selected{% endif %}>
          {{ r.name }}
        </option>
        {% endfor %}
      </select>
    </div>
    {% else %}
    <p class="hint">
      No complex-analytics CSVs found. Make sure you’ve run the pipelines:
      <code>pipelines/complex_sample.py</code> or <code>pipelines/complex_full.py</code>.
    </p>
    {% endif %}
  </form>
</section>

<section class="pane">
  <h2 class="pane-title">Report preview</h2>

  {% if selected_error %}
  <div class="alert alert-error">{{ selected_error }}</div>
  {% endif %}

  {% if table %}
    <p class="result-summary">
      Loaded <code>{{ table.path }}</code> with {{ table.rows|length }} row{{ table.rows|length != 1 and "s" or "" }}.
    </p>

    <div class="table-scroll">
      <table class="data-table">
        <thead>
          <tr>
            {% for col in table.columns %}
            <th>{{ col }}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for row in table.rows %}
          <tr>
            {% for col in table.columns %}
            <td>{{ row[col] }}</td>
            {% endfor %}
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% elif not selected_error and selected_path %}
    <p class="result-summary">No rows in this report.</p>
  {% else %}
    <p class="result-summary">Select a CSV report above to preview it.</p>
  {% endif %}
</section>
{% endblock %}
